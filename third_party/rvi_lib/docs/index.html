<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>Remote Vehicle Interface C API: REMOTE VEHICLE INTERFACE</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Remote Vehicle Interface C API
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li class="current"><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">REMOTE VEHICLE INTERFACE </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a href="https://travis-ci.org/tjamison/rvi_lib"></a></p>
<p>**(C) 2016 Jaguar Land Rover - All rights reserved.**</p>
<p>All documents in this repository are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0). Click <a href="https://creativecommons.org/licenses/by/4.0/">here</a> for details. All code in this repository is licensed under Mozilla Public License v2 (MPLv2). Click <a href="https://www.mozilla.org/en-US/MPL/2.0/">here</a> for details.</p>
<p>Remote Vehicle Interface (RVI) provides an architecture which, through its specified components, enables connected vehicles and other devices to form a secured distributed, sparsely connected peer-to-peer network. In particular, local services can be registered to enable remote invocation only when the peer presents appropriate credentials. In general, RVI provides an intermediary between less trusted remote sources and more trusted internal sources, limiting information that crosses trust boundaries.</p>
<p><code>rvi_lib</code> provides a client implementation in C. This is supplemental to <a href="https://github.com/GENIVI/rvi_core">RVI Core</a>, which adds a variety of capabilities including server behaviors.</p>
<h1>Documentation</h1>
<p><a href="http://genivi.github.io/rvi_lib">GitHub pages</a></p>
<h1>Standards Used</h1>
<ol type="1">
<li><a href="http://www.json.org/">JSON</a></li>
<li><a href="https://en.wikipedia.org/wiki/Base64">base64url</a></li>
<li><a href="https://tools.ietf.org/html/draft-ietf-oauth-json-web-token-32">JSON Web Token (JWT)</a></li>
<li><a href="https://en.wikipedia.org/wiki/X.509">X.509 Certificates</a></li>
<li><a href="https://tools.ietf.org/html/rfc5246">Transport Layer Security (TLS)</a></li>
</ol>
<h1>Build Requirements</h1>
<p><code>rvi_lib</code> depends on the following libraries and tools:</p>
<ol type="1">
<li><a href="https://www-s.acm.illinois.edu/webmonkeys/book/c_guide/index.html">C Standard Library</a></li>
<li><a href="https://www.openssl.org/">OpenSSL</a></li>
<li><a href="http://www.digip.org/jansson/">Jansson</a></li>
<li><a href="https://github.com/benmcollins/libjwt">LibJWT</a> †</li>
<li><a href="https://www.gnu.org/software/autoconf/autoconf.html">GNU Autotools</a></li>
</ol>
<p>† Included as a submodule.</p>
<p><code>rvi_lib</code> does not currently depend on the following but may add any or all to support interoperability with <a href="https://github.com/GENIVI/rvi_core">RVI Core</a> nodes:</p>
<ol type="1">
<li><a href="http://ludocode.github.io/mpack/">mpack</a></li>
</ol>
<h1>Build Instructions</h1>
<h4>Install prerequisites</h4>
<p>Install openssl and Jansson. On Ubuntu: </p><pre class="fragment">$ sudo apt-get install libssl-dev libjansson-dev
</pre><p>Ensure the following packages are also installed:</p>
<ul>
<li>git</li>
<li>make</li>
<li>GNU Autotools</li>
<li>gcc (or another c compiler)</li>
</ul>
<p>These can also be installed via <code>apt</code> on Ubuntu: </p><pre class="fragment">$ sudo apt-get install git make GNU Autotools gcc
</pre><h4>Clone repo recursively</h4>
<p>Clone or download this repo: </p><pre class="fragment">$ git clone --recursive https://github.com/GENIVI/rvi_lib.git
</pre><h4>Build</h4>
<p>Build the library using autotools. After cloning: </p><pre class="fragment">$ cd rvi_lib
$ autoreconf -i &amp;&amp; ./configure &amp;&amp; make
</pre><h4>Install</h4>
<p>To install the library and headers for use in applications or development, run the following: </p><pre class="fragment">$ make install
</pre><p>This will install both <code>libjwt</code> and <code>librvi</code> on your development platform. By default, both are installed to <code>/usr/local</code>; use <code>prefix</code> to specify an alternate location, as in: </p><pre class="fragment">$ make install prefix=/usr 
</pre><p>Some operating systems will require <code>sudo</code> for either operation.</p>
<h4>Quick Start</h4>
<p>If you would like to see an example of an application using <code>rvi_lib</code>, run the following: </p><pre class="fragment">$ make examples
$ cd examples
$ ./interactive
</pre><p>Initiating the RVI context requires a configuration file, along with X.509 certificates and one or more JWT credentials. See the "Configuration" section for details on configuring your own, or use the "conf.json" file for the pre-supplied (<em>insecure</em>) configuration.</p>
<p>Connect to a remote test RVI node at 38.129.64.41, port 9010. You can register services, invoke remote services, and process incoming messages.</p>
<p>Insecure configuration details, including private keys and certificates, are provided in the [examples](examples) folder. _*THESE CREDENTIALS MUST NOT BE USED IN PRODUCTION*_.</p>
<h1>Configuration</h1>
<p>When used in a calling application (such as the example "interactive" program), <code>rvi_lib</code> requires the client to be configured with a valid X.509 certificate for TLS exchanges, as well as (at least one) JWT-encoded RVI credential that matches the client's X.509 certificate.</p>
<p>All configuration options are specified via a JSON configuration file that is supplied when initializing the RVI library. A sample configuration file follows:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;{</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;  &quot;dev&quot;: {</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;    &quot;key&quot;:  &quot;./priv/clientkey.pem&quot;,</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;    &quot;cert&quot;: &quot;./priv/clientcert.pem&quot;,</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;    &quot;id&quot;: &quot;genivi.org/client/bbfbb478-d628-480a-8528-cff40d73678f&quot;</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;  },</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;  &quot;ca&quot;: {</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;    &quot;cert&quot;: &quot;./priv/cacert.pem&quot;,</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;    &quot;dir&quot;:  &quot;./priv/&quot;</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;  },</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;  &quot;creddir&quot;: &quot;priv/&quot;</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;}</div></div><!-- fragment --><p>Note the three-part structure of the ID: domain, followed by node type, followed by UUID. The UUID should be generated by an external method, such as Linux's uuidgen(1) or Microsoft's guidgen.exe.</p>
<p>Relative or absolute paths are permitted in the configuration file. All relative paths will be resolved relative to the working directory from which the process is invoked.</p>
<h2>Generate certificates and credentials (Development)</h2>
<p>The RVI architecture relies on X.509 certificates and JWT credentials created out-of-band of RVI message exchanges. These JWTs must be encoded using the RS256 algorithm (RSASSA-PKCS1-v1_5 with the SHA-256 hash algorithm).</p>
<p>X.509 certificates may be generated in the usual way. For development purposes, this can be done with a local Certification Authority (CA) to issue the certificates required. The <code>openssl</code> command-line suite must be available.</p>
<p>See Ivan Ristić's <a href="https://www.feistyduck.com/library/openssl-cookbook/">OpenSSL Cookbook</a> for more information about using the OpenSSL command-line suite. For convenience, condensed steps follow.</p>
<h3>Create the CA</h3>
<p>First, set up an environment for the CA to keep tabs on the certificates issued. On a *nix system: </p><pre class="fragment">$ mkdir rvica
$ cd rvica
$ mkdir certs private
$ chmod g-rwx,o-rwx private
$ echo '01' &gt; serial
$ touch index.txt
</pre><p>Then, add an openssl configuration file to the folder. A typical openssl installation places a configuration file at <code>/etc/ssl/openssl.cnf</code>. You may use this configuration file or copy it to the <code>rvica</code> directory and modify defaults as you wish.</p>
<p>Next, create a certificate signing request (CSR) and private key for the CA: </p><pre class="fragment">$ openssl req -newkey rsa:1024 -sha256 -keyout private/cakey.pem \ 
&gt;  -out careq.pem
</pre><p>Sign the request. (Note that this will be a self-signed certificate, which is typical for root CAs. No other certificates are self-signed in the RVI architecture.) </p><pre class="fragment">$ openssl x509 -req -in careq.pem -sha256 -extfile myopenssl.cnf \
&gt;  -extensions v3_ca -signkey private/cakey.pem -out cacert.pem
</pre><h3>On device: Generate private key and CSR</h3>
<p>The device should normally generate its own private key and CSR. If the device does not have this capacity, the key and CSR can be generated on another device and transfered via some secure method. (See, e.g., <a href="https://www.wolfssl.com/wolfSSL/Blog/Entries/2010/12/22_Keep_your_SSL_Private_Keys_Private.html">"Keep your SSL Private Keys Private"</a> for tips about private keys on embedded devices.)</p>
<p>Generate a key and CSR just as we did for the CA: </p><pre class="fragment">$ openssl req -newkey rsa:1024 -sha256 -keyout device_key.pem \
&gt;  -out devicereq.pem
</pre><p>The CSR, which does not contain any secret information, can then be sent to the CA. Copy it to the <code>rvica</code> directory if the CSR was generated on the same machine as the CA, or use e.g., <code>scp</code> or <code>sftp</code> to copy the file if it was generated on a networked device.</p>
<h3>CA: sign CSR and generate JWT credential</h3>
<p>Once the device's CSR is available to the CA, sign the request: </p><pre class="fragment">$ openssl x509 -req -in devicereq.pem -sha256 -extfile myopenssl.cnf \
&gt;  -extensions usr_cert -CA cacert.pem -CAkey private\cakey.pem \
&gt;  -CAcreateserial -out certs/devicecert.pem
</pre><p>In addition, generate a JWT using the <code>rvi_create_credential.py</code> script from <a href="https://github.com/GENIVI/rvi_core/tree/develop/scripts">rvi_core/scripts</a>: </p><pre class="fragment">$ ./rvi_create_credential.py \
&gt;  --id=&lt;id&gt; \                          # System-wide unique credential ID
&gt;  --invoke='&lt;services&gt;' \              # Granted right(s) to invoke
&gt;  --receive='&lt;services&gt;' \             # Granted right(s) to receive
&gt;  --root_key=private/cakey.pem \       # The CA's private key to sign the JWT
&gt;  --device_cert=certs/devicecert.pem \ # The device's X.509 certificate
&gt;  --start='&lt;YYYY-MM-DD HH:MM:SS&gt;' \    # Not valid before. Default: now
&gt;  --stop='&lt;YYYY-MM-DD HH:MM:SS&gt;' \     # Valid until. Default: a year from now
&gt;  --jwt_out=certs/device.jwt \         # Filename to store JWT. Default: stdout
&gt;  --cred_out=&lt;file&gt; \                  # Filename to store raw JSON. Default: none
&gt;  --issuer="Develop" \                 # Name of issuer
</pre><p>The credential ID is <em>not</em> the same as the device ID.</p>
<p>The following are mandatory:</p>
<ul>
<li><code>invoke</code></li>
<li><code>receive</code></li>
<li><code>root_key</code></li>
<li><code>device_cert</code></li>
<li><code>issuer</code></li>
</ul>
<p>Please note that order of flags matters.</p>
<p>RVI uses a pattern-based rights management system. All remote calls are made by passing a fully-qualified service name, which contain: domain, node type, UUID, and additional service name information. Each item is delimited by a forward slash ('/'). For example: </p><pre class="fragment">genivi.org/vehicle/dc23f560-8635-4c10-8aeb-34c13dad60b6/control/unlock
</pre><p>Pattern matches consist of prefix matching, with single-level wildcards permitted using the '+' character. In this example, the following rights <em>would</em> allow the device to invoke the above service if supplied to the <code>--invoke</code> flag: </p><pre class="fragment">genivi.org
genivi.org/vehicle/+/control
</pre><p>The following rights would <em>not</em> allow the device to invoke the above service: </p><pre class="fragment">jaguarlandrover.com
genivi.org/vehicle/unlock
</pre><p>It is up to the CA to establish a policy governing which rights are granted.</p>
<p>Once the CA has signed both the certificate and the RVI credential, both files (<code>certs/devicecert.pem</code> and <code>certs/device.jwt</code>) should be returned to the device. The device must also have the CA's certificate to add to the device's trusted certificate store.</p>
<h3>Connect RVI nodes</h3>
<p>To get full use of <code>rvi_lib</code>, you must connect to a node running <a href="https://github.com/GENIVI/rvi_core/">RVI Core</a>. You will need to supply the server node's IP address and port to the client. Additionally, the server and any clients must present certificates and credentials signed by mutually trusted CAs. For a typical development configuration, repeat the "Generate a device key
and CSR" and "Sign the CSR" steps above for the server. See <a href="https://github.com/GENIVI/rvi_core/">RVI Core</a> for additional configuration details. The <code>tlsj_backend</code> configuration is recommended.</p>
<h2>Generate certificates and credentials (Production)</h2>
<p>See <a href="https://github.com/GENIVI/rvi_core/">RVI Core</a> for discussion of generating certificates and RVI credentials for use in a production environment. Note that keys should be 2048 bits or larger for deployment, as 1024-bit keys may be vulnerable to brute force attacks within the key's lifetime.</p>
<h1>Contributions</h1>
<p><code>rvi_lib</code> is an open source project maintained by <a href="https://www.genivi.org/">GENIVI</a> for general use. Contributions are welcome, subject to licensing compatibility with MPL v2.0. Submit issues or pull requests via GitHub at the authoritative <a href="https://github.com/GENIVI/rvi_lib/">GENIVI/rvi_lib</a> repo.</p>
<h1>Limitations</h1>
<ul>
<li>Thread-safety. <code>rvi_lib</code> is designed for a single-threaded environment and is not thread safe in its current form.</li>
<li>Server capabilities. <code>rvi_lib</code> is designed to serve as a client only; it does not make ports available for other entities to initiate connections.</li>
<li>MessagePack support. <code>rvi_lib</code> currently only supports RVI commands transmitted as JSON objects. <a href="https://github.com/GENIVI/rvi_core">RVI Core</a> has introduced support for MessagePack encoding, so this is a planned enhancement. </li>
</ul>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Thu Nov 17 2016 12:05:50 for Remote Vehicle Interface C API by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
