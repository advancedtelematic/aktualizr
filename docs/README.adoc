= Aktualizr reference docs

This directory contains developer-focused documentation on various specialized aktualizr topics.

link:./client-provisioning-methods.adoc[client-provisioning-methods.adoc] - Describes how aktualizr handles provisioning with either shared credentials or device credentials. 

link:./configuration.adoc[configuration.adoc] - A reference for aktualizr's TOML config files.

link:./provisioning-methods-and-credentialszip.adoc[provisioning-methods-and-credentialszip.adoc] - An explanation of the format of credentials.zip, a bundle generated by HERE OTA Connect/OTA Community Edition containing necessary credentials and config for aktualizr and meta-updater.

link:./deb-package-install.adoc[deb-package-install.adoc] - The https://github.com/advancedtelematic/aktualizr/releases[releases] page includes a .deb package for aktualizr. This isn't likely useful for most production use cases, but it can be handy for testing. This document guides you through how to use the .deb.

link:./debugging-tips.adoc[debugging-tips.adoc] - Useful debugging info, mostly targeted at people contributing to the development of aktualizr.

link:./fault-injection.adoc[fault-injection.adoc] - How to inject faults during aktualizr runs, to help test failure cases of the system.

link:./provision-with-device-credentials.adoc[provision-with-device-credentials.adoc] - Provisioning with device credentials is a more secure way of provisioning devices. Unlike shared-credentials provisioning, each image is required to have some credentials side-loaded that are unique to the device which receives the image. This topic also explains of aktualizr's approach to using a hardware security module for provisioning with device credentials.

link:./integrate-libaktualizr.adoc[integrate-libaktualizr.adoc] - How to use Aktualizr as a library ('libaktualizr') to implement custom software update clients. This can be used to integrate Aktualizr with a user interface or to deliver updates to a custom package manager.

link:./linux-secondaries.adoc[linux-secondaries.adoc] - A quick how-to demonstrating aktualizr on a secondary ECU, using two QEMU devices.

link:./rollback.adoc[rollback.adoc] - Developer documentation on how aktualizr, OSTree, and u-boot can be used to implement automatic rollback of a failed update.

link:./schema-migrations.adoc[schema-migrations.adoc] - aktualizr uses a SQLite database for storing some config information and keys. This describes the steps needed for migrating the DB schema. Only useful for aktualizr developers.

link:./security.adoc[security.adoc] - A brief description of properties a system running aktualizr must have to conform with the Uptane security model.

link:./selectively-triggering-aktualizr.adoc[selectively-triggering-aktualizr.adoc] - Aktualizr normally runs as a service, polling for updates periodically. However, it can also be triggered externally--for example, in response to a shoulder-tap, or in response to user interaction on an HMI. This document describes how to do that.

== Developer documentation

Additional documentation intended for developers that may need to use the libaktualizr API should refer to link:https://advancedtelematic.github.io/aktualizr/index.html[this doc]:
[NOTE]
====
The link above is for the doxygen docs on master. Doxygen docs for the following tagged release versions are also available:

* https://advancedtelematic.github.io/aktualizr/2018.8/index.html[2018.8]
* https://advancedtelematic.github.io/aktualizr/2018.9/index.html[2018.9]
* https://advancedtelematic.github.io/aktualizr/2018.11/index.html[2018.11]
* https://advancedtelematic.github.io/aktualizr/2018.12/index.html[2018.12]
* https://advancedtelematic.github.io/aktualizr/2018.13/index.html[2018.13]
* https://advancedtelematic.github.io/aktualizr/2019.1/index.html[2019.1]
* https://advancedtelematic.github.io/aktualizr/2019.2/index.html[2019.2]
* https://advancedtelematic.github.io/aktualizr/2019.3/index.html[2019.3]
* https://advancedtelematic.github.io/aktualizr/2019.4/index.html[2019.4]
* https://advancedtelematic.github.io/aktualizr/2019.5/index.html[2019.5]
====

=== Updating doxygen on github

To update the doxygen documentation for master on github, you will need to do something like the following:

1. In an aktualizr repo, run `make doxygen` (or `make docs`) in the build directory.
1. Clone a second aktualizr repo and run `git checkout gh-pages`.
1. In the second repo, run `git rm search/* *.css *.html *.js *.png *.map *.md5 *.png *.svg`.
1. Copy the contents of `<build_dir>/docs/html` into the root of the second repo. (Something like `cp -a <build_dir>/docs/html/* <second_repo>`.)
1. In the second repo, run `git add .`, `git commit -as`, and `git push`.
1. Wait a minute or two for github to refresh and render the files.

==== Adding docs for a new tag

To add doxygen docs for a new tag, you will need to do something like the following:

1. Check out the tag or commit you wish to add (`git checkout 2018.63`, for example).
1. Clean out the build directory (to remove stale objects), then run CMake and doxygen again:
+
----
rm -rf build/*
cd build
cmake ..
make doxygen
----
+
1. Clone a second aktualizr repo and run `git checkout gh-pages`.
1. In the second repo, make a directory for the tag or commit you wish to add, i.e. `mkdir 2018.63`.
1. Copy the contents of `<build_dir>/docs/html` into the directory you just created. (Something like `cp -a <build_dir>/docs/html/* <second_repo>/2018.63`.)
1. In the second repo, run `git add 2018.63`, `git commit -as`, and `git push`.
1. Wait a minute or two for github to refresh and render the files.
